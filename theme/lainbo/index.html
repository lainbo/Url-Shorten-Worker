<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="txt/html; charset=utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous"> -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/lainbo/Url-Shorten-Worker@crazypeace-gh-pages/components-v2.css">
  <title>Lainbo短链接生成</title>
  <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/gh/lainbo/Url-Shorten-Worker@crazypeace-gh-pages/main1.js"
    crossorigin="anonymous"></script>
  <!-- <script defer src="/main1.js"></script> -->
</head>

<body>
  <div id="app" class="bg-#f3f4f6 min-h-100vh">
    <main class="flow-root">
      <form class="space-y-8 bg-#fff max-w-768px mx-auto my-0 rounded-lg shadow-xl sm:mt-10vh">
        <div class="space-y-8 sm:space-y-5">
          <div>
            <div class="h-14 flex items-center px-4">
              <h2 class="text-24px leading-6 font-medium text-gray-900">短链接生成</h2>
            </div>

            <div class="space-y-6 sm:space-y-5 px-4">
              <div class="sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                <label id="basic-addon1" for="originalUrl"
                  class="block text-md font-medium text-gray-700 sm:mt-px sm:pt-2"> 原始链接
                </label>
                <div class="mt-1 sm:mt-0 sm:col-span-2">
                  <div class="max-w-lg flex rounded-md shadow-sm">
                    <input v-model="longURL" aria-describedby="basic-addon1" placeholder="Example: https://example.com/"
                      oninput="loadUrlList()" type="text" name="originalUrl"
                      class="flex-1 block w-full focus:ring-indigo-500 focus:border-indigo-500 min-w-0  rounded-md sm:text-sm border-gray-300">
                  </div>
                </div>
              </div>
              <div class="sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start  sm:pt-5">
                <label id="basic-addon2" for="customUrl"
                  class="block text-md font-medium text-gray-700 sm:mt-px sm:pt-2"> 自定义后缀
                </label>
                <div class="mt-1 sm:mt-0 sm:col-span-2">
                  <div class="max-w-lg flex rounded-md shadow-sm">
                    <input v-model="keyPhrase" type="text" name="customUrl" aria-describedby="basic-addon2"
                      placeholder="不填写将随机分配"
                      class="flex-1 block w-full focus:ring-indigo-500 focus:border-indigo-500 min-w-0  rounded-md sm:text-sm border-gray-300">
                  </div>
                </div>
              </div>
              <div>
                <button type="button"
                  class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                  @click="shorturl">{{submitText}}</button>
              </div>
              <div class="sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                <label id="basic-addon2" for="pagePassword"
                  class="block text-md font-medium text-gray-700 sm:mt-px sm:pt-2"> 生成结果
                </label>
                <div class="mt-1 sm:mt-0 sm:col-span-2">
                  <div class="max-w-lg flex rounded-md shadow-sm">
                    <input type="text" name="pagePassword" value="__PASSWORD__" readonly="true" id="passwordText"
                      aria-describedby="basic-addon3"
                      class="flex-1 block w-full focus:ring-indigo-500 focus:border-indigo-500 min-w-0  rounded-md sm:text-sm border-gray-300">
                  </div>
                </div>
              </div>

              <div class="space-x-4">
                <button type="button"
                  class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">加载本地存储</button>
                <button type="button"
                  class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">清空本地存储</button>
              </div>
              <div class="card-text">
                <div classs="list-group" id="urlList">
                  <div class="list-group-item">
                    <button type="button" class="btn btn-danger" onclick='deleteShortUrl("4rEbzm")'>X</button>
                    <span>some text</span>
                  </div>
                  <div class="list-group-item">
                    <button type="button" class="btn btn-danger" onclick='deleteShortUrl("8NKY34")'>X</button>
                    <span>some text some text some text some text some text some text some text some text some text some
                      text
                      some text </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
      </form>
      <div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="resultModalLabel">结果</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="result">没有结果</div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" onclick='copyurl("result")' data-toggle="popover"
                data-placement="bottom" data-content="Copied!">复制</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>
    let vm = new Vue({
      el: '#app',
      data() {
        return {
          longURL: "", // 原始链接
          keyPhrase: "", // 自定义后缀
          submitText: "生成短链接",
          submitLoading: false,
          passwordText: window.location.pathname.slice(1),
        }
      },
      created() {

      },
      mounted() { },
      methods: {
        async fetchShortUrl() {
          const obj = {
            cmd: "add",
            url: this.longURL,
            keyPhrase: this.keyPhrase,
            password: this.passwordText
          }
          try {
            const data = await axios.post('https://u.lainbo.com/Xwr9G7Vc39u4rLb6', obj)
            console.log('data:', data)
          } catch (error) {
            console.log('error:', error)
          }
        },

        shorturl() {
          let res
          if (!this.longURL.trim()) {
            alert("你还没有输入原始链接")
            return
          }

          this.submitLoading = true;
          this.submitText = "正在生成..."
          this.fetchShortUrl()
          // fetch(window.location.pathname, {
          //   method: 'POST',
          //   headers: { 'Content-Type': 'application/json' },
          //   body: JSON.stringify({ cmd: "add", url: document.querySelector("#longURL").value, keyPhrase: document.querySelector("#keyPhrase").value, password: document.querySelector("#passwordText").value })
          // }).then(function (response) {
          //   return response.json();
          // })
          //   .then(function (myJson) {
          //     res = myJson;
          //     this.submitLoading = false;
          //     this.submitText = "生成短链接"

          //     // 成功生成短链
          //     if (res.status == "200") {
          //       let keyPhrase = res.key;
          //       let valueLongURL = document.querySelector("#longURL").value;
          //       localStorage.setItem(keyPhrase, valueLongURL);
          //       addUrlToList(keyPhrase, valueLongURL)
          //       document.getElementById("result").innerHTML = window.location.protocol + "//" + window.location.host + "/" + res.key;
          //     } else {
          //       document.getElementById("result").innerHTML = res.error;
          //     }

          //   }).catch(function (err) {
          //     this.submitLoading = false;
          //     this.submitText = "生成短链接"
          //   })
        }
      },
      computed: {},
      watch: {}
    })
  </script>
</body>

</html>
